function ubb2html(f){var b=String(f),o=[],l=0;b=b.replace(/&/ig,"&amp;");b=b.replace(/[<>]/g,function(i){return{"<":"&lt;",">":"&gt;"}[i]});b=b.replace(/\r?\n/g,"<br />");b=b.replace(/\[code\s*(?:=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(i,h,j){l++;o[l]=i;return"[\tubbcodeplace_"+l+"\t]"});b=b.replace(/\[(\/?)(b|u|i|s|sup|sub)\]/ig,"<$1$2>");b=b.replace(/\[color\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font color="$1">');b=b.replace(/\[size\s*=\s*(\d+?)\s*\]/ig,'<font size="$1">');b=b.replace(/\[font\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,
'<font face="$1">');b=b.replace(/\[\/(color|size|font)\]/ig,"</font>");b=b.replace(/\[back\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<span style="background-color:$1;">');b=b.replace(/\[\/back\]/ig,"</span>");for(f=0;f<3;f++)b=b.replace(/\[align\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\](((?!\[align(?:\s+[^\]]+)?\])[\s\S])*?)\[\/align\]/ig,'<p align="$1">$2</p>');b=b.replace(/\[img\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/img\]/ig,'<img src="$1" />');b=b.replace(/\[img\s*=(?:\s*(\d*%?)\s*,\s*(\d*%?)\s*)?(?:,?\s*(\w+))?\s*\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*)?\s*\[\/img\]/ig,
function(i,h,j,a,n){i='<img src="'+n+'"';a=a?a:isNaN(h)?h:"";isNaN(h)||(i+=' width="'+h+'"');isNaN(j)||(i+=' height="'+j+'"');if(a)i+=' align="'+a+'"';i+=" />";return i});b=b.replace(/\[emot\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\/\]/ig,'<img emot="$1" />');b=b.replace(/\[url\]\s*(((?!")[\s\S])*?)(?:"[\s\S]*?)?\s*\[\/url\]/ig,'<a href="$1">$1</a>');b=b.replace(/\[url\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]*?)\s*\[\/url\]/ig,'<a href="$1">$2</a>');b=b.replace(/\[email\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/email\]/ig,
'<a href="mailto:$1">$1</a>');b=b.replace(/\[email\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]+?)\s*\[\/email\]/ig,'<a href="mailto:$1">$2</a>');b=b.replace(/\[quote\]([\s\S]*?)\[\/quote\]/ig,"<blockquote>$1</blockquote>");b=b.replace(/\[flash\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/flash\]/ig,function(i,h,j,a){h||(h=480);j||(j=400);return'<embed type="application/x-shockwave-flash" src="'+a+'" wmode="opaque" quality="high" bgcolor="#ffffff" menu="false" play="true" loop="true" width="'+
h+'" height="'+j+'"/>'});b=b.replace(/\[media\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/media\]/ig,function(i,h,j,a,n){h||(h=480);j||(j=400);return'<embed type="application/x-mplayer2" src="'+n+'" enablecontextmenu="false" autostart="'+(a=="1"?"true":"false")+'" width="'+h+'" height="'+j+'"/>'});b=b.replace(/\[table\s*(?:=\s*(\d{1,4}%?)\s*(?:,\s*([^\]"]+)(?:"[^\]]*?)?)?)?\s*\]/ig,function(i,h,j){i="<table";if(h)i+=' width="'+h+'"';if(j)i+=' bgcolor="'+
j+'"';return i+">"});b=b.replace(/\[tr\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(i,h){return"<tr"+(h?' bgcolor="'+h+'"':"")+">"});b=b.replace(/\[td\s*(?:=\s*(\d{1,2})\s*,\s*(\d{1,2})\s*(?:,\s*(\d{1,4}%?))?)?\s*\]/ig,function(i,h,j,a){return"<td"+(h>1?' colspan="'+h+'"':"")+(j>1?' rowspan="'+j+'"':"")+(a?' width="'+a+'"':"")+">"});b=b.replace(/\[\/(table|tr|td)\]/ig,"</$1>");b=b.replace(/\[\*\]((?:(?!\[\*\]|\[\/list\]|\[list\s*(?:=[^\]]+)?\])[\s\S])+)/ig,"<li>$1</li>");b=b.replace(/\[list\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,
function(i,h){i="<ul";if(h)i+=' type="'+h+'"';return i+">"});b=b.replace(/\[\/list\]/ig,"</ul>");for(f=1;f<=l;f++)b=b.replace("[\tubbcodeplace_"+f+"\t]",o[f]);return b=b.replace(/(^|<\/?\w+(?:\s+[^>]*?)?>)([^<$]+)/ig,function(i,h,j){return h+j.replace(/[\t ]/g,function(a){return{"\t":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"," ":"&nbsp;"}[a]})})}
function html2ubb(f){function b(d){var c;if(c=d.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){d="#";for(var e=1;e<=3;e++)d+=(c[e]-0).toString(16)}return d=d.replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3")}var o={"xx-small":1,"8pt":1,"x-small":2,"10pt":2,small:3,"12pt":3,medium:4,"14pt":4,large:5,"18pt":5,"x-large":6,"24pt":6,"xx-large":7,"36pt":7},l=/\s+src\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i,i=/\s+width\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,h=/\s+height\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,
j=/(?:background|background-color|bgcolor)\s*[:=]\s*(["']?)\s*((rgb\s*\(\s*\d{1,3}%?,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\))|(#[0-9a-f]{3,6})|([a-z]{1,20}))\s*\1/i,a=String(f),n=[],p=0;a=a.replace(/\s*\r?\n\s*/g,"");a=a.replace(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/ig,"");a=a.replace(/<!--[\s\S]*?--\>/ig,"");a=a.replace(/<br\s*?\/?>/ig,"\r\n");a=a.replace(/\[code\s*(=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(d,c,e){p++;n[p]=d;return"[\tubbcodeplace_"+p+"\t]"});a=a.replace(/<(\/?)(b|u|i|s)(\s+[^>]*?)?>/ig,
"[$1$2]");a=a.replace(/<(\/?)strong(\s+[^>]*?)?>/ig,"[$1b]");a=a.replace(/<(\/?)em(\s+[^>]*?)?>/ig,"[$1i]");a=a.replace(/<(\/?)(strike|del)(\s+[^>]*?)?>/ig,"[$1s]");a=a.replace(/<(\/?)(sup|sub)(\s+[^>]*?)?>/ig,"[$1$2]");for(f=0;f<3;f++)a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color|background|background-color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,
function(d,c,e,g){d=e.match(/(?:^|;)\s*font-family\s*:\s*([^;]+)/i);c=e.match(/(?:^|;)\s*font-size\s*:\s*([^;]+)/i);var k=e.match(/(?:^|;)\s*color\s*:\s*([^;]+)/i);e=e.match(/(?:^|;)\s*(?:background|background-color)\s*:\s*([^;]+)/i);g=g;if(d)g="[font="+d[1]+"]"+g+"[/font]";if(c)if(c=o[c[1].toLowerCase()])g="[size="+c+"]"+g+"[/size]";if(k)g="[color="+b(k[1])+"]"+g+"[/color]";if(e)g="[back="+b(e[1])+"]"+g+"[/back]";return g});for(f=0;f<3;f++)a=a.replace(/<(div|p)(?:\s+[^>]*?)?[\s"';]\s*(?:text-)?align\s*[=:]\s*(["']?)\s*(left|center|right)\s*\2[^>]*>(((?!<\1(\s+[^>]*?)?>)[\s\S])+?)<\/\1>/ig,
"[align=$3]$4[/align]");for(f=0;f<3;f++)a=a.replace(/<(center)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,"[align=center]$2[/align]");for(f=0;f<3;f++)a=a.replace(/<(p|div)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*text-align\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(d,c,e,g){});a=a.replace(/<a(?:\s+[^>]*?)?\s+href=(["'])\s*(.+?)\s*\1[^>]*>\s*([\s\S]*?)\s*<\/a>/ig,
function(d,c,e,g){if(!(e&&g))return"";d="url";if(e.match(/^mailto:/i)){d="email";e=e.replace(/mailto:(.+?)/i,"$1")}c="["+d;if(e!=g)c+="="+e;return c+"]"+g+"[/"+d+"]"});a=a.replace(/<img(\s+[^>]*?)\/?>/ig,function(d,c){if(d=c.match(/\s+emot\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i))return"[emot="+d[2]+"/]";d=c.match(l);var e=c.match(i),g=c.match(h);c=c.match(/\s+align\s*=\s*(["']?)\s*(\w+)\s*\1(\s|$)/i);var k="[img",m="";if(!d)return"";if(e||g)m+=(e?e[2]:"")+","+(g?g[2]:"");if(c)m+=(e||g?",":"")+c[2];if(m)k+=
"="+m;k+="]"+d[2];return k+"[/img]"});a=a.replace(/<blockquote(?:\s+[^>]*?)?>([\s\S]+?)<\/blockquote>/ig,"[quote]$1[/quote]");a=a.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-shockwave-flash\s*"|\s+classid\s*=\s*"\s*clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000\s*")[^>]*?)\/>/ig,function(d,c){d=c.match(l);var e=c.match(i);c=c.match(h);var g="[flash";if(!d)return"";if(e&&c)g+="="+e[2]+","+c[2];g+="]"+d[2];return g+"[/flash]"});a=a.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-mplayer2\s*"|\s+classid\s*=\s*"\s*clsid:6bf52a52-394a-11d3-b153-00c04f79faa6\s*")[^>]*?)\/>/ig,
function(d,c){d=c.match(l);var e=c.match(i),g=c.match(h);c=c.match(/\s+autostart\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);var k="[media",m="0";if(!d)return"";if(c)if(c[2]=="true")m="1";if(e&&g)k+="="+e[2]+","+g[2]+","+m;k+="]"+d[2];return k+"[/media]"});a=a.replace(/<table(\s+[^>]*?)?>/ig,function(d,c){d="[table";if(c){var e=c.match(i);c=c.match(j);if(e){d+="="+e[2];if(c)d+=","+c[2]}}return d+"]"});a=a.replace(/<tr(\s+[^>]*?)?>/ig,function(d,c){d="[tr";if(c)if(c=c.match(j))d+="="+c[2];return d+"]"});a=
a.replace(/<(?:th|td)(\s+[^>]*?)?>/ig,function(d,c){d="[td";if(c){var e=c.match(/\s+colspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),g=c.match(/\s+rowspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i);c=c.match(i);e=e?e[2]:1;g=g?g[2]:1;if(e>1||g>1||c)d+="="+e+","+g;if(c)d+=","+c[2]}return d+"]"});a=a.replace(/<\/(table|tr)>/ig,"[/$1]");a=a.replace(/<\/(th|td)>/ig,"[/td]");a=a.replace(/<ul(\s+[^>]*?)?>/ig,function(d,c){var e;if(c)e=c.match(/\s+type\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);return"[list"+(e?"="+e[2]:"")+
"]"});a=a.replace(/<ol(\s+[^>]*?)?>/ig,"[list=1]");a=a.replace(/<li(\s+[^>]*?)?>/ig,"[*]");a=a.replace(/<\/li>/ig,"");a=a.replace(/<\/(ul|ol)>/ig,"[/list]");a=a.replace(/<h([1-6])(\s+[^>]*?)?>/ig,function(d,c){return"\r\n\r\n[size="+(7-c)+"][b]"});a=a.replace(/<\/h[1-6]>/ig,"[/b][/size]\r\n\r\n");a=a.replace(/<address(\s+[^>]*?)?>/ig,"\r\n[i]");a=a.replace(/<\/address>/ig,"[i]\r\n");for(f=0;f<3;f++)a=a.replace(/<(p)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,
"\r\n\r\n$2\r\n\r\n");for(f=0;f<3;f++)a=a.replace(/<(div)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n$2\r\n");a=a.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n");a=a.replace(/^((\s|&nbsp;)*\r?\n)+/g,"");a=a.replace(/((\s|&nbsp;)*\r?\n)+$/g,"");for(f=1;f<=p;f++)a=a.replace("[\tubbcodeplace_"+f+"\t]",n[f]);a=a.replace(/<[^<>]+?>/g,"");a=a.replace(/&lt;/ig,"<");a=a.replace(/&gt;/ig,
">");a=a.replace(/&nbsp;/ig," ");return a=a.replace(/&amp;/ig,"&")};
