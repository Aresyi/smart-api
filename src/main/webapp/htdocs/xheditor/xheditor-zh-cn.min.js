(function(d){d.fn.xheditor=function(B){var D=[];this.each(function(){if(d.nodeName(this,"textarea"))if(B===false){if(this.editor){this.editor.remove();this.editor=null}}else if(!this.editor){var G=/({.*})/.exec(d(this).attr("class"));if(G){try{G=eval("("+G[1]+")")}catch(ja){}B=d.extend({},G,B)}G=new d.xheditor(this,B);if(G.init()){this.editor=G;D.push(G)}}});if(D.length==0)D=false;if(D.length==1)D=D[0];return D};var W=0,ta=d.browser.version,y=d.browser.msie,ka=d.browser.mozilla,X=d.browser.safari,
Na=d.browser.opera,R=false,la=true,K,$,aa,ba,ma,S;d("script[src*=xheditor]").each(function(){var B=this.src;if(B.match(/xheditor[^\/]*\.js/i)){S=B.replace(/[\?#].*$/,"").replace(/(^|[\/\\])[^\/]*$/,"$1");return false}});var Oa={27:"esc",9:"tab",32:"space",13:"enter",8:"backspace",145:"scroll",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"del",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",
119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},Pa=["#FFFFFF","#CCCCCC","#C0C0C0","#999999","#666666","#333333","#000000","#FFCCCC","#FF6666","#FF0000","#CC0000","#990000","#660000","#330000","#FFCC99","#FF9966","#FF9900","#FF6600","#CC6600","#993300","#663300","#FFFF99","#FFFF66","#FFCC66","#FFCC33","#CC9933","#996633","#663333","#FFFFCC","#FFFF33","#FFFF00","#FFCC00","#999900","#666600","#333300","#99FF99","#66FF99","#33FF33","#33CC00","#009900","#006600","#003300","#99FFFF","#33FFFF","#66CCCC",
"#00CCCC","#339999","#336666","#003333","#CCFFFF","#66FFFF","#33CCFF","#3366FF","#3333FF","#000099","#000066","#CCCCFF","#9999FF","#6666CC","#6633FF","#6600CC","#333399","#330099","#FFCCFF","#FF99FF","#CC66CC","#CC33CC","#993399","#663366","#330033"],Qa=[{n:"p",t:"\u666e\u901a\u6bb5\u843d"},{n:"h1",t:"\u6807\u98981"},{n:"h2",t:"\u6807\u98982"},{n:"h3",t:"\u6807\u98983"},{n:"h4",t:"\u6807\u98984"},{n:"h5",t:"\u6807\u98985"},{n:"h6",t:"\u6807\u98986"},{n:"pre",t:"\u5df2\u7f16\u6392\u683c\u5f0f"},{n:"address",
t:"\u5730\u5740"}],Ra=[{n:"\u5b8b\u4f53",c:"SimSun"},{n:"\u4eff\u5b8b\u4f53",c:"FangSong_GB2312"},{n:"\u9ed1\u4f53",c:"SimHei"},{n:"\u6977\u4f53",c:"KaiTi_GB2312"},{n:"\u5fae\u8f6f\u96c5\u9ed1",c:"Microsoft YaHei"},{n:"Arial"},{n:"Arial Narrow"},{n:"Arial Black"},{n:"Comic Sans MS"},{n:"Courier New"},{n:"System"},{n:"Times New Roman"},{n:"Tahoma"},{n:"Verdana"}],P=[{n:"xx-small",wkn:"x-small",s:"8pt",t:"\u6781\u5c0f"},{n:"x-small",wkn:"small",s:"10pt",t:"\u7279\u5c0f"},{n:"small",wkn:"medium",s:"12pt",
t:"\u5c0f"},{n:"medium",wkn:"large",s:"14pt",t:"\u4e2d"},{n:"large",wkn:"x-large",s:"18pt",t:"\u5927"},{n:"x-large",wkn:"xx-large",s:"24pt",t:"\u7279\u5927"},{n:"xx-large",wkn:"-webkit-xxx-large",s:"36pt",t:"\u6781\u5927"}],Sa=[{s:"\u5de6\u5bf9\u9f50",v:"justifyleft"},{s:"\u5c45\u4e2d",v:"justifycenter"},{s:"\u53f3\u5bf9\u9f50",v:"justifyright"},{s:"\u4e24\u7aef\u5bf9\u9f50",v:"justifyfull"}],Ta=[{s:"\u6570\u5b57\u5217\u8868",v:"insertOrderedList"},{s:"\u7b26\u53f7\u5217\u8868",v:"insertUnorderedList"}],
Ua={"default":{name:"\u9ed8\u8ba4",width:25,height:18,line:6,list:{biggrin:"Big grin",smile:"Smile",titter:"Titter",lol:"Lol",call:"Call",victory:"Victory",shy:"Shy",handshake:"Handshake",kiss:"Kiss",sad:"Sad",cry:"Cry",huffy:"Huffy",mad:"Mad",tongue:"Tongue",sweat:"Sweat",shocked:"Shocked",time:"Time",hug:"Hug"}}},ca={GStart:{},GEnd:{},Separator:{},Cut:{t:"\u526a\u5207 (Ctrl+X)"},Copy:{t:"\u590d\u5236 (Ctrl+C)"},Paste:{t:"\u7c98\u8d34 (Ctrl+V)"},Pastetext:{t:"\u7c98\u8d34\u6587\u672c",h:y?0:1},Blocktag:{t:"\u6bb5\u843d\u6807\u7b7e",
h:1},Fontface:{t:"\u5b57\u4f53",h:1},FontSize:{t:"\u5b57\u4f53\u5927\u5c0f",h:1},Bold:{t:"\u52a0\u7c97 (Ctrl+B)",s:"Ctrl+B"},Italic:{t:"\u659c\u4f53 (Ctrl+I)",s:"Ctrl+I"},Underline:{t:"\u4e0b\u5212\u7ebf (Ctrl+U)",s:"Ctrl+U"},Strikethrough:{t:"\u5220\u9664\u7ebf (Ctrl+S)",s:"Ctrl+S"},FontColor:{t:"\u5b57\u4f53\u989c\u8272",h:1},BackColor:{t:"\u80cc\u666f\u989c\u8272",h:1},Removeformat:{t:"\u5220\u9664\u6587\u5b57\u683c\u5f0f"},Align:{t:"\u5bf9\u9f50",h:1},List:{t:"\u5217\u8868",h:1},Outdent:{t:"\u51cf\u5c11\u7f29\u8fdb (Shift+Tab)",
s:"Shift+Tab"},Indent:{t:"\u589e\u52a0\u7f29\u8fdb (Tab)",s:"Tab"},Link:{t:"\u8d85\u94fe\u63a5",h:1},Unlink:{t:"\u53d6\u6d88\u8d85\u94fe\u63a5"},Img:{t:"\u56fe\u7247",h:1},Flash:{t:"Flash\u52a8\u753b",h:1},Media:{t:"\u591a\u5a92\u4f53\u6587\u4ef6",h:1},Emot:{t:"\u8868\u60c5",s:"ctrl+e",h:1},Table:{t:"\u8868\u683c",h:1},Source:{t:"\u6e90\u4ee3\u7801"},Preview:{t:"\u9884\u89c8"},Fullscreen:{t:"\u5168\u5c4f\u7f16\u8f91 (Esc)",s:"Esc"},About:{t:"\u5173\u4e8e xhEditor",h:1}},ua={mini:"GStart,Bold,Italic,Underline,Strikethrough,GEnd,Separator,GStart,Align,List,GEnd,Separator,GStart,Link,Img,About,GEnd",
simple:"GStart,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,GEnd,Separator,GStart,Align,List,Outdent,Indent,GEnd,Separator,GStart,Link,Img,Emot,About,GEnd",full:"GStart,Cut,Copy,Paste,Pastetext,GEnd,Separator,GStart,Blocktag,Fontface,FontSize,Bold,Italic,Underline,Strikethrough,FontColor,BackColor,Removeformat,GEnd,Separator,GStart,Align,List,Outdent,Indent,GEnd,Separator,GStart,Link,Unlink,Img,Flash,Media,Emot,Table,GEnd,Separator,GStart,Source,Preview,Fullscreen,About,GEnd"};
d.xheditor=function(B,D){function G(a,c){var e=typeof a;if(!c)return e!="undefined";if(c=="array"&&a.hasOwnProperty&&a instanceof Array)return true;return e==c}function ja(a,c){var e=location.protocol,h=location.hostname,m=location.port,k=location.pathname.replace(/\\/g,"/").replace(/[^\/]+$/i,"");m=m==""?"80":m;a=d.trim(a);if(e=="file:")c="abs";if(c!="abs")a=a.replace(new RegExp(e+"\\/\\/"+h.replace(/\./g,"\\.")+"(?::"+m+")"+(m=="80"?"?":"")+"(/|$)","i"),"/");if(c=="rel")a=a.replace(new RegExp("^"+
k.replace(/([\/\.\+\[\]\(\)])/g,"\\$1"),"i"),"");if(c!="rel")a.match(/^((https?|file):\/\/|\/)/i)||(a=k+a);if(c=="abs")a.match(/(https?|file):\/\//i)||(a=e+"//"+location.host+a);return a}var b=this,N=d(B),Ca=N.closest("form"),C,O,T,na,s,da,oa,va=false,A=false,J=false,ea=false,wa=false,fa=false,Da="",L=null,xa,ga=false,ya=false,Y=null,U=null,Q=0;this.settings=d.extend({},{skin:"default",tools:"full",clickCancelDialog:true,linkTag:false,internalScript:false,inlineScript:false,internalStyle:true,inlineStyle:true,
showBlocktag:false,forcePtag:true,upLinkExt:"zip,rar,txt",upImgExt:"jpg,jpeg,gif,png",upFlashExt:"swf",upMediaExt:"wmv,avi,wma,mp3,mid",modalWidth:350,modalHeight:220,modalTitle:true,defLinkText:"\u70b9\u51fb\u6253\u5f00\u94fe\u63a5",layerShadow:3,emotMark:false,upBtnText:"\u4e0a\u4f20",wordDeepClean:true,hoverExecDelay:100},D);if(D=b.settings.plugins){var Ea=[];d.each(D,function(a){Ea.push(a)});ua.full=ua.full.replace("Table","Table,"+Ea.join(","));ca=d.extend({},ca,D)}if(b.settings.tools.match(/^\s*(mini|simple|full)\s*$/i)){b.settings.tools=
d.trim(b.settings.tools);b.settings.tools=ua[b.settings.tools]}b.settings.tools.match(/(^|,)\s*About\s*(,|$)/i)||(b.settings.tools+=",About");b.settings.tools=b.settings.tools.split(",");S=ja(S,"abs");var Fa="xheCSS_"+b.settings.skin,ha="xhe"+W+"_container",Ga="xhe"+W+"_Tool",Ha="xhe"+W+"_iframearea",Ia="xhe"+W+"_iframe",za="xhe"+W+"_fixffcursor",V="",Aa=S+"xheditor_skin/"+b.settings.skin+"/",pa=Ua,Ja=ja(S,"rel")+"xheditor_emot/",Ba="";pa=d.extend({},pa,b.settings.emots);if(fa=b.settings.showBlocktag)V+=
" showBlocktag";var qa=[];this.init=function(){d("#"+Fa).length==0&&d("head").append('<link id="'+Fa+'" rel="stylesheet" type="text/css" href="'+Aa+'ui.css" />');var a=b.settings.width||B.style.width||N.outerWidth();Q=b.settings.height||B.style.height||N.outerHeight();if(G(Q,"string"))Q=Q.replace(/[^\d]+/g,"");if(a<=0||Q<=0){alert("\u5f53\u524dtextarea\u5904\u4e8e\u9690\u85cf\u72b6\u6001\uff0c\u8bf7\u5c06\u4e4b\u663e\u793a\u540e\u518d\u521d\u59cb\u5316xhEditor\uff0c\u6216\u8005\u76f4\u63a5\u8bbe\u7f6etextarea\u7684width\u548cheight\u6837\u5f0f");
return false}if(/^[0-9\.]+$/i.test(""+a))a+="px";var c="",e,h;d.each(b.settings.tools,function(j,f){e=ca[f];if(f=="GStart")c+='<span class="xheGStart"/>';else if(f=="GEnd")c+='<span class="xheGEnd"/>';else if(f=="Separator")c+='<span class="xheSeparator"/>';else if(f=="BtnBr")c+="<br />";else{h=e.c?e.c:"xheIcon xheBtn"+f;c+='<span><a href="javascript:void(0);" title="'+e.t+'" name="'+f+'" class="xheButton xheEnabled" tabindex="-1"><span class="'+h+'" /></a></span>';e.s&&b.addShortcuts(e.s,f)}});c+=
"<br />";N.after(d('<input type="text" id="'+za+'" style="position:absolute;display:none;" /><span id="'+ha+'" class="xhe_'+b.settings.skin+'" style="display:none"><table cellspacing="0" cellpadding="0" class="xheLayout" style="width:'+a+";height:"+Q+'px;"><tbody><tr><td id="'+Ga+'" class="xheTool" style="height:1px;"></td></tr><tr><td id="'+Ha+'" class="xheIframeArea"><iframe frameborder="0" id="'+Ia+'" src="" style="width:100%;"></iframe></td></tr></tbody></table></span>'));C=d("#"+Ga);O=d("#"+
Ha);a='<html><head><base /><meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/><link rel="stylesheet" href="'+Aa+'iframe.css"/>';if(b.settings.loadCSS){var m=b.settings.loadCSS;if(G(m,"array"))for(var k in m)a+='<link rel="stylesheet" href="'+m[k]+'"/>';else a+='<link rel="stylesheet" href="'+m+'"/>'}a+='</head><body spellcheck="false" dir="ltr" class="editMode'+V+'"></body></html>';b.win=T=d("#"+Ia)[0].contentWindow;na=d(T);try{this.doc=s=T.document;da=d(s);s.open();s.write(a);s.close();
if(y)s.body.contentEditable="true";else s.designMode="On"}catch(p){}setTimeout(b.setOpts,300);b.setSource();T.setInterval=null;C.append(c);C.find(".xheButton").click(function(j){var f=d(this);if(f.is(".xheEnabled")){L=j;b.exec(f.attr("name"))}return false}).hover(function(j){var f=d(this),g=b.settings.hoverExecDelay,i=U;U=null;if(g==-1||ga||!f.is(".xheEnabled"))return false;if(i&&i>10){ga=true;setTimeout(function(){ga=false},100);return false}var l=f.attr("name");if(ca[l].h!=1){b.hidePanel();return false}if(ya)g=
0;if(g>=0)xa=setTimeout(function(){L=j;Y={x:L.clientX,y:L.clientY};b.exec(l)},g)},function(){Y=null;xa&&clearTimeout(xa)}).mousemove(function(j){if(Y){var f={x:j.clientX-Y.x,y:j.clientY-Y.y};if(Math.abs(f.x)>1||Math.abs(f.y)>1){if(f.x>0&&f.y>0){f=Math.round(Math.atan(f.y/f.x)/0.017453293);U=U?(U+f)/2:f}else U=null;Y={x:j.clientX,y:j.clientY}}}}).mousedown(function(){return false});K=d("#xhePanel");$=d("#xheShadow");aa=d("#xheCntLine");ma=d("#xheTempIframe");if(K.length==0){K=d('<div id="xhePanel"></div>').mousedown(function(j){j.stopPropagation()});
$=d('<div id="xheShadow"></div>');aa=d('<div id="xheCntLine"></div>');ma=d('<iframe id="xheTempIframe" class="xheHideArea" />');d(document.body).append(K).append($).append(aa).append(ma)}d(document).mousedown(b.clickCancelPanel);da.mousedown(b.clickCancelPanel);d("#"+ha).show();O.css("height",Q-C.outerHeight());N.hide();N.focus(b.focus);Ca.submit(b.getSource).bind("reset",b.loadReset);k=d(window);k.unload(b.saveUnload).bind("beforeunload",b.saveUnload);k.resize(b.fixFullHeight);na.focus(function(){b.settings.focus&&
b.settings.focus()}).blur(function(){b.settings.blur&&b.settings.blur()});X&&na.click(b.fixAppleSel);da.keydown(b.checkShortcuts).keypress(b.forcePtag).bind("mousedown click",function(j){N.trigger(j.type)}).keyup(b.triggerChange);if(y){function n(j){j=d(j.target);var f;if(f=j.css("width"))j.css("width","").attr("width",f.replace(/[^0-9%]+/g,""));if(f=j.css("height"))j.css("height","").attr("height",f.replace(/[^0-9%]+/g,""))}da.bind("controlselect",function(j){j=j.target;j.nodeName=="IMG"&&d(j).unbind("resizeend",
n).bind("resizeend",n)})}d("body",da).bind("paste",b.cleanPaste);(k=b.settings.shortcuts)&&d.each(k,function(j,f){b.addShortcuts(j,f)});W++;va=true;b.settings.fullscreen&&b.toggleFullscreen();if(b.settings.readonly)b.toggleReadonly(true);else b.settings.sourceMode&&setTimeout(b.toggleSource,20);return true};this.remove=function(){b.hidePanel();N.unbind("focus",b.focus);Ca.unbind("submit",b.getSource).unbind("reset",b.loadReset);var a=d(window);a.unbind("unload",b.saveUnload).unbind("beforeunload",
b.saveUnload);a.unbind("resize",b.fixFullHeight);d("#"+ha).remove();N.show();va=false};this.loadReset=function(){setTimeout(b.setSource,10)};this.saveUnload=function(){b.getSource()};this.triggerChange=function(){N.trigger("change")};this.cleanPaste=function(){if(y&&!A){var a;a=ma[0].contentWindow.document.body;a.innerHTML="";a.createTextRange().execCommand("Paste");a=a.innerHTML;if(a.indexOf("&nbsp;")==0)a=a.substring(6);a=b.formatXHTML(a);a=b.cleanWord(a);a=b.cleanHTML(a);b.pasteHTML(a);return false}};
this.setCSS=function(a){try{b._exec("styleWithCSS",a)}catch(c){try{b._exec("useCSS",!a)}catch(e){}}};this.setOpts=function(){if(va&&!J&&!A){b.setCSS(false);try{b._exec("enableObjectResizing",true)}catch(a){}if(y)try{b._exec("BackgroundImageCache",true)}catch(c){}}};this.forcePtag=function(a){if(A||J||a.keyCode!=13||a.shiftKey||a.ctrlKey||a.altKey)return true;a=b.getParent("p,h1,h2,h3,h4,h5,h6,pre,address,div,li");if(b.settings.forcePtag)a.length==0&&b._exec("formatblock","<p>");else{b.pasteHTML("<br />");
return false}};this.fixFullHeight=function(){if(!ka&&!X){O.height("100%");ea&&O.css("height",O.outerHeight()-C.outerHeight());y&&C.hide().show()}};this.fixAppleSel=function(a){a=a.target;if(a.tagName.match(/(img|embed)/i)){var c=b.getSel(),e=b.getRng();e.selectNode(a);c.removeAllRanges();c.addRange(e)}};this.saveBookmark=function(){A||(oa=b.getRng())};this.loadBookmark=function(){if(!A){b.focus();if(y)oa.select();else{var a=b.getSel();a.removeAllRanges();a.addRange(oa)}}};this.focus=function(){A?
d("#sourceCode",s).focus():na.focus();return false};this.setCursorFirst=function(a){b.focus();T.scrollTo(0,0);var c=b.getRng(),e=s.body,h=e,m;if(a&&h.firstChild&&(m=h.firstChild.tagName)&&m.match(/^p|div|h[1-6]$/i))h=e.firstChild;if(y){a=e.createTextRange();a.moveToElementText(h);c.setEndPoint("StartToStart",a)}else c.setStart(h,0);c.collapse(true);if(y)c.select();else{h=b.getSel();h.removeAllRanges();h.addRange(c)}};this.getSel=function(){return T.getSelection?T.getSelection():s.selection};this.getRng=
function(){var a=b.getSel(),c;try{c=a.rangeCount>0?a.getRangeAt(0):a.createRange?a.createRange():s.createRange()}catch(e){}c||(c=y?s.body.createTextRange():s.createRange());return c};this.getParent=function(a){var c=b.getRng(),e;if(y)e=c.item?c.item(0):c.parentElement();else{e=c.commonAncestorContainer;if(!c.collapsed)if(c.startContainer==c.endContainer&&c.startOffset-c.endOffset<2&&c.startContainer.hasChildNodes())e=c.startContainer.childNodes[c.startOffset]}a=a?a:"*";e=d(e);e.is(a)||(e=d(e).closest(a));
return e};this.getSelect=function(a){var c=b.getSel(),e=b.getRng(),h=true;h=!e||e.item?false:!c||e.boundingWidth==0||e.collapsed;if(a=="text")return h?"":e.text||(c.toString?c.toString():"");if(e.cloneContents){a=d("<div></div>");(e=e.cloneContents())&&a.append(e);e=a.html()}else e=G(e.item)?e.item(0).outerHTML:G(e.htmlText)?e.htmlText:e.toString();if(h)e="";e=b.processHTML(e,"read");e=b.formatXHTML(e);return e=b.cleanHTML(e)};this.pasteHTML=function(a,c){if(A||J)return false;b.focus();a=b.processHTML(a,
"write");var e=b.getSel(),h=b.getRng();if(c!=undefined){if(h.item){var m=h.item(0);h=s.body.createTextRange();h.moveToElementText(m);h.select()}h.collapse(c)}if(h.insertNode){h.deleteContents();a=h.createContextualFragment(a);c=a.lastChild;h.insertNode(a);h.setEndAfter(c);h.collapse(false);e.removeAllRanges();e.addRange(h)}else{if(e.type.toLowerCase()=="control"){e.clear();h=b.getRng()}h.pasteHTML(a)}b.triggerChange()};this.pasteText=function(a,c){a||(a="");a=b.domEncode(a);a=a.replace(/\r?\n/g,"<br />");
b.pasteHTML(a,c)};this.appendHTML=function(a){if(A||J)return false;b.focus();a=b.processHTML(a,"write");d(s.body).append(a)};this.domEncode=function(a){return a.replace(/[<>]/g,function(c){return{"<":"&lt;",">":"&gt;"}[c]})};this.setSource=function(a){oa=null;if(typeof a!="string"&&a!="")a=B.value;if(A)d("#sourceCode",s).val(a);else{if(b.settings.beforeSetSource)a=b.settings.beforeSetSource(a);a=b.formatXHTML(a);a=b.cleanWord(a);a=b.cleanHTML(a);d(s.body).html(b.processHTML(a,"write"))}b.triggerChange()};
this.processHTML=function(a,c){if(c=="write"){function e(f,g,i,l){l=l.split(",");if(!l[1]){l[1]=l[0];l[0]=""}if(l[0]=="default")l[0]="";return f.replace(/\s+src\s*=\s*(["']?).*?\1(\s|$|\/|>)/i,"$2").replace(g,' src="'+Ja+(l[0]?l[0]:"default")+"/"+l[1]+'.gif"'+(b.settings.emotMark?' emot="'+(l[0]?l[0]+",":"")+l[1]+'" alt="'+l[1]+'"':""))}a=a.replace(/<img(?:\s+[^>]*?)?(\s+emot\s*=\s*(["']?)\s*(.*?)\s*\2)(?:\s+[^>]*?)?\/?>/ig,e);function h(f,g,i,l,o,q){return f.replace(i,i+" _xhe_"+l+'="'+q+'"')}a=
a.replace(/<(\w+(?:\:\w+)?)(?:\s+[^>]*?)?(\s+(src|href)\s*=\s*(["']?)\s*(.*?)\s*\4)(?:\s+[^>]*?)?\/?>/ig,h);a=a.replace(/<(\/?)del(\s+[^>]*?)?>/ig,"<$1strike$2>");if(ka){a=a.replace(/<(\/?)strong(\s+[^>]*?)?>/ig,"<$1b$2>");a=a.replace(/<(\/?)em(\s+[^>]*?)?>/ig,"<$1i$2>")}else if(X){a=a.replace(/("|;)\s*font-size\s*:\s*([a-z-]+)(;?)/ig,function(f,g,i,l){for(var o,q=0;q<P.length;q++){f=P[q];if(i==f.n){o=f.wkn;break}}return g+"font-size:"+o+l});a=a.replace(/<strong(\s+[^>]*?)?>/ig,'<span class="Apple-style-span" style="font-weight: bold;"$1>');
a=a.replace(/<em(\s+[^>]*?)?>/ig,'<span class="Apple-style-span" style="font-style: italic;"$1>');a=a.replace(/<u(\s+[^>]*?)?>/ig,'<span class="Apple-style-span" style="text-decoration: underline;"$1>');a=a.replace(/<strike(\s+[^>]*?)?>/ig,'<span class="Apple-style-span" style="text-decoration: line-through;"$1>');a=a.replace(/<\/(strong|em|u|strike)>/ig,"</span>");a=a.replace(/<span((?:\s+[^>]*?)?\s+style="([^"]*;)*\s*(font-family|font-size|color|background-color)\s*:\s*[^;"]+\s*;?"[^>]*)>/ig,'<span class="Apple-style-span"$1>')}else if(y){a=
a.replace(/&apos;/ig,"&#39;");a=a.replace(/\s+(disabled|checked|readonly|selected)\s*=\s*[\"\']?(false|0)[\"\']?/ig,"")}a=a.replace(/<a(\s+[^>]*?)?\/>/,"<a$1></a>");if(!X){function m(f,g,i,l){g="";var o,q;if(o=i.match(/font-family\s*:\s*([^;"]+)/i))g+=' face="'+o[1]+'"';if(o=i.match(/font-size\s*:\s*([^;"]+)/i)){o=o[1].toLowerCase();for(var t=0;t<P.length;t++)if(o==P[t].n||o==P[t].s){q=t+1;break}if(q){g+=' size="'+q+'"';i=i.replace(/(^|;)(\s*font-size\s*:\s*[^;"]+;?)+/ig,"$1")}}if(q=i.match(/(?:^|[\s;])color\s*:\s*([^;"]+)/i)){if(o=
q[1].match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){q[1]="#";for(t=1;t<=3;t++)q[1]+=(o[t]-0).toString(16)}q[1]=q[1].replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3");g+=' color="'+q[1]+'"'}i=i.replace(/(^|;)(\s*(font-family|color)\s*:\s*[^;"]+;?)+/ig,"$1");if(g!=""){if(i)g+=' style="'+i+'"';return"<font"+g+">"+l+"</font>"}else return f}a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,
m);a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,m);a=a.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,m)}a=a.replace(/<img(?:\s+[^>]*?)?(\s+alt\s*=\s*(["']?)\s*(.*?)\s*\2)(?:\s+[^>]*?)?\/?>/ig,
function(f,g,i,l){return l?f:f.replace(g,"")})}else{var k=b.settings.localUrl;function p(f,g,i,l){if(k)l=ja(l,k);return f.replace(new RegExp("\\s+"+g+"\\s*=\\s*([\"']?).*?\\1([\\s/>])","ig")," "+g+'="'+l.replace(/\$/g,"$$$$")+'"$2')}a=a.replace(/<(?:\w+(?:\:\w+)?)(?:\s+[^>]*?)?\s+_xhe_(src|href)\s*=\s*(["']?)\s*(.*?)\s*\2(?:\s+[^>]*?)?\/?>/ig,p);if(X){a=a.replace(/("|;)\s*font-size\s*:\s*([a-z-]+)(;?)/ig,function(f,g,i,l){for(var o,q=0;q<P.length;q++){f=P[q];if(i==f.wkn){o=f.n;break}}return g+"font-size:"+
o+l});var n=[{r:/font-weight:\sbold/ig,t:"strong"},{r:/font-style:\sitalic/ig,t:"em"},{r:/text-decoration:\sunderline/ig,t:"u"},{r:/text-decoration:\sline-through/ig,t:"strike"}];function j(f,g,i,l,o){g=i+l;i="";for(l=0;l<n.length;l++)if(g.match(n[l].r)){i=n[l].t;break}return i?"<"+i+">"+o+"</"+i+">":f}a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,j);a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,
j);a=a.replace(/<(span)(\s+[^>]*?)?\s+class\s*=\s*"Apple-style-span"(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,j)}a=a.replace(/(<\w+(?:\s+[^>]*?)?)\s+(?:_xhe_|_moz_|_webkit_)[^=]+?\s*=\s*(["']?).*?\2([\s\/>])/ig,"$1$3");a=a.replace(/(<\w+[^>]*?)\s+class\s*=\s*(["']?)\s*(?:apple|webkit)\-.+?\s*\2([\s\/>])/ig,"$1$3");a=a.replace(/<img(\s+[^>]+?)\/?>/ig,function(f,g){g.match(/\s+alt\s*(["']?).*?\1(\s|$)/i)||
(g+=' alt=""');return"<img"+g+" />"})}return a};this.getSource=function(a){var c,e=b.settings.beforeGetSource;if(A){c=d("#sourceCode",s).val();e||(c=c.replace(/(\t*\r?\n\t*)+/g,""))}else{c=b.processHTML(d(s.body).html(),"read");c=c.replace(/^\s*(?:<(p|div)(?:\s+[^>]*?)?>)?\s*(<br(?:\s+[^>]*?)?>)*\s*(?:<\/\1>)?\s*$/i,"");c=b.formatXHTML(c,a);c=b.cleanWord(c);c=b.cleanHTML(c);if(e)c=e(c)}return B.value=c};this.cleanWord=function(a){if(a.match(/mso-|MsoNormal/i)){var c=b.settings.wordDeepClean;a=a.replace(/(<link(?:\s+[^>]*?)?)\s+href\s*=\s*(["']?)\s*file:\/\/.+?\s*\2((?:\s+[^>]*?)?\s*\/?>)/ig,
"");a=a.replace(/<!--[\s\S]*?--\>|<!(--)?\[[\s\S]+?\](--)?>|<style(\s+[^>]*?)?>[\s\S]*?<\/style>/ig,"");a=a.replace(/<\/?\w+:[^>]*>/ig,"");if(c)a=a.replace(/<\/?(span|a|img)(\s+[^>]*?)?>/ig,"");a=a.replace(/(<\w+(?:\s+[^>]*?)?)\s+class\s*=\s*(["']?)\s*mso.+?\s*\2((?:\s+[^>]*?)?\s*\/?>)/ig,"$1$3");a=a.replace(/(<\w+(?:\s+[^>]*?)?)\s+lang\s*=\s*(["']?)\s*.+?\s*\2((?:\s+[^>]*?)?\s*\/?>)/ig,"$1$3");a=a.replace(/(<\w+(?:\s+[^>]*?)?)\s+align\s*=\s*(["']?)\s*left\s*\2((?:\s+[^>]*?)?\s*\/?>)/ig,"$1$3");a=
a.replace(/<\w+(?:\s+[^>]*?)?(\s+style\s*=\s*(["']?)\s*(.*?)\s*\2)(?:\s+[^>]*?)?\s*\/?>/ig,function(e,h,m,k){k=d.trim(k.replace(/\s*(mso-[^:]+:.+?|margin\s*:\s*0cm 0cm 0pt\s*|(text-align|font-variant|line-height)\s*:\s*.+?)(;|$)\s*/ig,""));return e.replace(h,c?"":k?' style="'+k+'"':"")})}return a};this.cleanHTML=function(a){a=a.replace(/<\??xml(:\w+)?(\s+[^>]*?)?>([\s\S]*?<\/xml>)?/ig,"");a=a.replace(/<\/?(html|head|body|meta|title)(\s+[^>]*?)?>/ig,"");b.settings.linkTag||(a=a.replace(/<link(\s+[^>]*?)?>/ig,
""));b.settings.internalScript||(a=a.replace(/<script(\s+[^>]*?)?>[\s\S]*?<\/script>/ig,""));b.settings.inlineScript||(a=a.replace(/(<\w+)(\s+[^>]*?)?\s+on(?:click|dblclick|mousedown|mouseup|mousemove|mouseover|mouseout|mouseenter|mouseleave|keydown|keypress|keyup|change|select|submit|reset|blur|focus|load|unload)\s*=\s*(["']?).*?\3((?:\s+[^>]*?)?\/?>)/ig,"$1$2$4"));b.settings.internalStyle||(a=a.replace(/<style(\s+[^>]*?)?>[\s\S]*?<\/style>/ig,""));b.settings.inlineStyle||(a=a.replace(/(<\w+)(\s+[^>]*?)?\s+(style|class)\s*=\s*(["']?).*?\3((?:\s+[^>]*?)?\/?>)/ig,
"$1$2$4"));return a=a.replace(/<\/(strong|b|u|strike|em|i)>((?:\s|<br\/?>|&nbsp;)*?)<\1(\s+[^>]*?)?>/ig,"$2")};this.formatXHTML=function(a,c){function e(r){var u={};r=r.split(",");for(var z=0;z<r.length;z++)u[r[z]]=true;return u}function h(r){if(r){r=r.toLowerCase();var u=q[r];if(u)r=u}else r="";return r}function m(r,u,z){r=h(r);if(f[r])for(;v.last()&&g[v.last()];)k("",v.last());i[r]&&v.last()==r&&k("",r);(z=j[r]||!!z)||v.push(r);var H=Array();H.push("<"+r);u.replace(M,function(Z,ia,Ka,La,Ma){ia=
ia.toLowerCase();H.push(" "+ia+'="'+(Ka?Ka:La?La:Ma?Ma:l[ia]?ia:"")+'"')});H.push((z?" /":"")+">");p(H.join(""),r,true)}function k(r){if(r){r=h(r);for(u=v.length-1;u>=0;u--)if(v[u]==r)break}else var u=0;if(u>=0){for(r=v.length-1;r>=u;r--)p("</"+v[r]+">",v[r]);v.length=u}}function p(r,u,z){if(u=="pre"&&!z)ra=false;ra||(r=r.replace(/(\t*\r?\n\t*)+/g,""));if(c==true&&!ra){if(!r.match(/^\s*$/)){var H=f[u],Z=H?u:"";if(H){z&&I++;F==""&&I--}else F&&I++;if(Z!=F||H){E.push("\r\n");if(I>0)for(Z=I;Z--;)E.push("\t")}E.push(r);
if(u=="br"){E.push("\r\n");if(I>0)for(Z=I;Z--;)E.push("\t")}H&&!z&&I--;if(F=="pre"&&sa)ra=true;F=H?u:"";sa=z}}else E.push(r)}function n(r,u,z,H){r="";if(u=z.match(/ face\s*=\s*"\s*([^"]+)\s*"/i))r+="font-family:"+u[1]+";";if(u=z.match(/ size\s*=\s*"\s*(\d+)\s*"/i))r+="font-size:"+P[(u[1]>7?7:u[1]<1?1:u[1])-1].n+";";if(u=z.match(/ color\s*=\s*"\s*([^"]+)\s*"/i))r+="color:"+u[1]+";";if(z=z.match(/ style\s*=\s*"\s*([^"]+)\s*"/i))r+=z[1];if(r)H='<span style="'+r+'">'+H+"</span>";return H}var j=e("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),
f=e("address,applet,blockquote,button,center,dd,dir,div,dl,dt,fieldset,form,frameset,h1,h2,h3,h4,h5,h6,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),g=e("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,del,strong,sub,sup,textarea,tt,u,var"),i=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),l=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),
o=e("script,style"),q={b:"strong",i:"em",s:"del",strike:"del"},t=/^<\??(\w+(?:\:\w+)?)((?:\s+[\w-\:]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,x=/^<\/(\w+(?:\:\w+)?)[^>]*>/,M=/([\w-(?:\:\w+)?]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,w=0,v=[];a=a;var E=Array(),I=-1,F="body",sa,ra=false;for(v.last=function(){return this[this.length-1]};a.length>0;)if(!v.last()||!o[v.last()]){w=0;if(a.substring(0,4)=="<!--"){w=a.indexOf("--\>");if(w!=-1){w+=3;p(a.substring(0,
w))}}else if(a.substring(0,2)=="</"){if(match=a.match(x)){k(match[1]);w=match[0].length}}else if(a.charAt(0)=="<")if(match=a.match(t)){m(match[1],match[2],match[3]);w=match[0].length}if(w==0){w=a.indexOf("<");if(w==0)w=1;else if(w<0)w=a.length;p(b.domEncode(a.substring(0,w)))}a=a.substring(w)}else{a=a.replace(/^([\s\S]*?)<\/(style|script)>/i,function(r,u){p(u);return""});k(v.last())}k("");a=E.join("");E=null;a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,n);a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,
n);a=a.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,n);a=a.replace(/^(\s*\r?\n)+|(\s*\r?\n)+$/g,"");return a=a.replace(/(\t*\r?\n)+/g,"\r\n")};this.toggleShowBlocktag=function(a){if(fa!==a){fa=!fa;a=d(s.body);if(fa){V+=" showBlocktag";a.addClass("showBlocktag")}else{V=V.replace(" showBlocktag","");a.removeClass("showBlocktag")}}};this.toggleReadonly=function(a){if(wa!==
a){A&&b.toggleSource(true);if(wa=!wa){J||b.togglePreview(true);C.find("[name=Preview]").toggleClass("xheEnabled").toggleClass("xheActive")}else{C.find("[name=Preview]").toggleClass("xheEnabled").toggleClass("xheActive");J&&b.togglePreview()}}};this.toggleSource=function(a){if(!(J||A===a)){C.find("[name=Source]").toggleClass("xheEnabled").toggleClass("xheActive");var c=s.body,e=d(c),h,m,k="_xhe_cursor"+(new Date).getTime();a=0;if(A){h=b.getSource();e.find("#sourceCode").remove();e.removeAttr("scroll").attr("class",
"editMode"+V);if(y)c.contentEditable="true";else s.designMode="On";if(ka){b._exec("inserthtml","-");d("#"+za).show().focus().hide()}}else{b.pasteHTML(k,true);h=b.getSource(true);a=h.indexOf(k);if(!Na)a=h.substring(0,a).replace(/\r/g,"").length;h=h.replace(k,"");if(y)c.contentEditable="false";else s.designMode="Off";e.attr("scroll","no").attr("class","sourceMode").html('<textarea id="sourceCode" wrap="soft" spellcheck="false" height="100%" />');m=d("#sourceCode",e).blur(b.getSource)[0]}A=!A;b.setSource(h);
if(A){b.focus();if(m.setSelectionRange)m.setSelectionRange(a,a);else{m=m.createTextRange();m.move("character",a);m.select()}}else b.setCursorFirst(true);C.find("[name=Source]").toggleClass("xheEnabled");C.find(".xheButton").not("[name=Source],[name=Fullscreen],[name=About]").toggleClass("xheEnabled");setTimeout(b.setOpts,300)}};this.togglePreview=function(a){if(!(A||J===a)){C.find("[name=Preview]").toggleClass("xheActive").toggleClass("xheEnabled");a=d(s.body);if(J){a.attr("class","editMode"+V);d("head base",
s).removeAttr("target");if(y)s.body.contentEditable="true";else s.designMode="On"}else{a.attr("class","previewMode");d("head base",s).attr("target","_blank");if(y)s.body.contentEditable="false";else s.designMode="Off"}a[0].innerHTML=a.html();J=!J;b.setCursorFirst();C.find("[name=Preview]").toggleClass("xheEnabled");C.find(".xheButton").not("[name=Preview],[name=Fullscreen],[name=About]").toggleClass("xheEnabled");setTimeout(b.setOpts,300)}};this.toggleFullscreen=function(a){if(ea!==a){a=d("#"+ha).find(".xheLayout");
var c=d("#"+ha);if(ea){a.attr("style",Da);O.height(Q-C.outerHeight())}else{Da=a.attr("style");a.removeAttr("style");O.height("100%");setTimeout(b.fixFullHeight,100)}if(ka){d("#"+za).show().focus().hide();setTimeout(b.focus,1)}ea=!ea;c.toggleClass("xhe_Fullscreen");d("html").toggleClass("xhe_Fullfix");C.find("[name=Fullscreen]").toggleClass("xheActive");setTimeout(b.setOpts,300)}};this.showMenu=function(a,c){var e=d('<div class="xheMenu"></div>'),h;d.each(a,function(m,k){h=d('<a href="javascript:void(0);" title="'+
(k.t?k.t:k.s)+'">'+k.s+"</a>").click(function(){c(k.v);b.hidePanel();return false}).mousedown(function(){return false});e.append(h)});b.showPanel(e)};this.showColor=function(a){var c=d('<div class="xheColor"></div>'),e,h,m=0;e=d("<div></div>");d.each(Pa,function(k,p){m++;h=d('<a href="javascript:void(0);" title="'+p+'" style="background:'+p+'"></a>').click(function(){a(p);b.hidePanel();return false}).mousedown(function(){return false});e.append(h);if(m%7==0){c.append(e);e=d("<div></div>")}});c.append(e);
b.showPanel(c)};this.showPastetext=function(){var a=d('<div>\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl+V)\u628a\u5185\u5bb9\u7c98\u8d34\u5230\u65b9\u6846\u91cc\uff0c\u6309 \u786e\u5b9a</div><div><textarea id="xhePastetextValue" wrap="soft" spellcheck="false" style="width:300px;height:100px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),c=d("#xhePastetextValue",a);d("#xheSave",a).click(function(){b.loadBookmark();var e=c.val();e&&b.pasteText(e);
b.hidePanel();return false});b.showDialog(a)};this.showLink=function(){var a=d('<div>\u94fe\u63a5\u5730\u5740: <input type="text" id="xheLinkHref" value="http://" class="xheText" /></div><div>\u6253\u5f00\u65b9\u5f0f: <select id="xheLinkTarget"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="_blank">\u65b0\u7a97\u53e3</option><option value="_self">\u5f53\u524d\u7a97\u53e3</option><option value="_parent">\u7236\u7a97\u53e3</option></select></div><div style="display:none">\u94fe\u63a5\u6587\u5b57: <input type="text" id="xheLinkText" value="" class="xheText" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),
c=b.getParent("a"),e=d("#xheLinkText",a),h=d("#xheLinkHref",a),m=d("#xheLinkTarget",a),k=d("#xheSave",a),p=b.getSelect();if(c.length==1){h.val(b.attr(c,"href"));m.attr("value",c.attr("target"))}else p==""&&e.val(b.settings.defLinkText).closest("div").show();b.settings.upLinkUrl&&b.uploadInit(h,b.settings.upLinkUrl,b.settings.upLinkExt);k.click(function(){var n=h.val();b.loadBookmark();if(n==""||c.length==0)b._exec("unlink");if(n!=""&&n!="http://"){var j=n.split("\t"),f=m.val(),g=e.val();if(j.length>
1){b._exec("unlink");p=b.getSelect();var i='<a href="xhe_tmpurl"';if(f!="")i+=' target="'+f+'"';i+=">xhe_tmptext</a>&nbsp;";g=p!=""?p:g?g:n;for(var l in j){n=j[l];if(n!=""){n=n.split(",");f=i;f=f.replace("xhe_tmpurl",n[0]);f=f.replace("xhe_tmptext",n[1]?n[1]:g);b.pasteHTML(f)}}}else{n=j[0].split(",");g||(g=n[0]);g=n[1]?n[1]:p!=""?"":g?g:n[0];if(c.length==0){g?b.pasteHTML('<a href="#xhe_tmpurl">'+g+"</a>"):b._exec("createlink","#xhe_tmpurl");c=d('a[href$="#xhe_tmpurl"]',s)}b.attr(c,"href",n[0]);f!=
""?c.attr("target",f):c.removeAttr("target");g&&!X&&c.text(g)}}b.hidePanel();return false});b.showDialog(a)};this.showImg=function(){var a=d('<div>\u56fe\u7247\u6587\u4ef6: <input type="text" id="xheImgSrc" value="http://" class="xheText" /></div><div>\u66ff\u6362\u6587\u672c: <input type="text" id="xheImgAlt" /></div><div>\u5bf9\u9f50\u65b9\u5f0f: <select id="xheImgAlign"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="left">\u5de6\u5bf9\u9f50</option><option value="right">\u53f3\u5bf9\u9f50</option><option value="top">\u9876\u7aef</option><option value="middle">\u5c45\u4e2d</option><option value="baseline">\u57fa\u7ebf</option><option value="bottom">\u5e95\u8fb9</option></select></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheImgWidth" style="width:40px;" /> x <input type="text" id="xheImgHeight" style="width:40px;" /></div><div>\u8fb9\u6846\u5927\u5c0f: <input type="text" id="xheImgBorder" style="width:40px;" /></div><div>\u6c34\u5e73\u95f4\u8ddd: <input type="text" id="xheImgHspace" style="width:40px;" /> \u5782\u76f4\u95f4\u8ddd: <input type="text" id="xheImgVspace" style="width:40px;" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),
c=b.getParent("img"),e=d("#xheImgSrc",a),h=d("#xheImgAlt",a),m=d("#xheImgAlign",a),k=d("#xheImgWidth",a),p=d("#xheImgHeight",a),n=d("#xheImgBorder",a),j=d("#xheImgVspace",a),f=d("#xheImgHspace",a),g=d("#xheSave",a);if(c.length==1){e.val(b.attr(c,"src"));h.val(c.attr("alt"));m.val(c.attr("align"));k.val(c.attr("width"));p.val(c.attr("height"));n.val(c.attr("border"));var i=c.attr("vspace"),l=c.attr("hspace");j.val(i<=0?"":i);f.val(l<=0?"":l)}b.settings.upImgUrl&&b.uploadInit(e,b.settings.upImgUrl,
b.settings.upImgExt);g.click(function(){b.loadBookmark();var o=e.val();if(o!=""&&o!="http://"){var q=o.split("\t"),t=h.val(),x=m.val(),M=k.val(),w=p.val(),v=n.val(),E=j.val(),I=f.val();if(q.length>1){var F='<img src="xhe_tmpurl"';if(t!="")F+=' alt="'+t+'"';if(x!="")F+=' align="'+x+'"';if(M!="")F+=' width="'+M+'"';if(w!="")F+=' height="'+w+'"';if(v!="")F+=' border="'+v+'"';if(E!="")F+=' vspace="'+E+'"';if(I!="")F+=' hspace="'+I+'"';F+=" />&nbsp;";for(var sa in q){o=q[sa];if(o!=""){o=o.split(",");t=
F;t=t.replace("xhe_tmpurl",o[0]);if(o[1])t='<a href="'+o[1]+'" target="_blank">'+t+"</a>";b.pasteHTML(t)}}}else if(q.length==1){o=q[0];if(o!=""){o=o.split(",");if(c.length==0){b.pasteHTML('<img src="'+o[0]+'#xhe_tmpurl" />');c=d('img[src$="#xhe_tmpurl"]',s)}b.attr(c,"src",o[0]);t!=""&&c.attr("alt",t);x!=""?c.attr("align",x):c.removeAttr("align");M!=""?c.attr("width",M):c.removeAttr("width");w!=""?c.attr("height",w):c.removeAttr("height");v!=""?c.attr("border",v):c.removeAttr("border");E!=""?c.attr("vspace",
E):c.removeAttr("vspace");I!=""?c.attr("hspace",I):c.removeAttr("hspace");if(o[1]){q=c.parent("a");if(q.length==0){c.wrap("<a></a>");q=c.parent("a")}b.attr(q,"href",o[1]);q.attr("target","_blank")}}}}else c.length==1&&c.remove();b.hidePanel();return false});b.showDialog(a)};this.showEmbed=function(a,c,e,h,m,k,p){c=d(c);var n=b.getParent('embed[type="'+e+'"],embed[classid="'+h+'"]'),j=d("#xhe"+a+"Src",c),f=d("#xhe"+a+"Width",c),g=d("#xhe"+a+"Height",c);a=d("#xheSave",c);k&&b.uploadInit(j,k,p);b.showDialog(c);
if(n.length==1){j.val(b.attr(n,"src"));f.val(n.attr("width"));g.val(n.attr("height"))}a.click(function(){b.loadBookmark();var i=j.val();if(i!=""&&i!="http://"){var l=f.val(),o=g.val(),q=/^[0-9]+$/;q.test(l)||(l=412);q.test(o)||(o=300);var t='<embed type="'+e+'" classid="'+h+'" src="xhe_tmpurl"'+m;q=i.split("\t");if(q.length>1){t=t+"";var x;t+=' width="xhe_width" height="xhe_height" />&nbsp;';for(var M in q){i=q[M].split(",");x=t;x=x.replace("xhe_tmpurl",i[0]);x=x.replace("xhe_width",i[1]?i[1]:l);
x=x.replace("xhe_height",i[2]?i[2]:o);i!=""&&b.pasteHTML(x)}}else if(q.length==1){i=q[0].split(",");if(n.length==0){b.pasteHTML(t.replace("xhe_tmpurl",i[0]+"#xhe_tmpurl")+" />");n=d('embed[src$="#xhe_tmpurl"]',s)}b.attr(n,"src",i[0]);n.attr("width",i[1]?i[1]:l);n.attr("height",i[2]?i[2]:o)}}else n.length==1&&n.remove();b.hidePanel();return false})};this.showEmot=function(a){var c=d('<div class="xheEmot"></div>');a=a?a:Ba?Ba:"default";var e=pa[a],h=Ja+a+"/",m=0,k=[],p="";p=e.width;var n=e.height,j=
e.line,f=e.count;e=e.list;if(f)for(e=1;e<=f;e++){m++;k.push('<a href="javascript:void(0);" style="background-image:url('+h+e+'.gif);" emot="'+a+","+e+'" title='+e+">&nbsp;</a>");m%j==0&&k.push("<br />")}else d.each(e,function(o,q){m++;k.push('<a href="javascript:void(0);" style="background-image:url('+h+o+'.gif);" emot="'+a+","+o+'" title="'+q+'">&nbsp;</a>');m%j==0&&k.push("<br />")});f=j*(p+12);e=Math.ceil(m/j)*(n+12);var g=f*0.75;if(e<=g)g="";p=d("<style>"+(g?".xheEmot div{width:"+(f+20)+"px;height:"+
g+"px;}":"")+".xheEmot div a{width:"+p+"px;height:"+n+"px;}</style><div>"+k.join("")+"</div>");d("a",p).click(function(){var o=d(this);b.pasteHTML('<img emot="'+o.attr("emot")+'" alt="'+o.attr("title")+'">');b.hidePanel();return false});c.append(p);var i=0,l=["<ul>"];d.each(pa,function(o,q){i++;l.push("<li"+(a==o?' class="cur"':"")+'><a href="javascript:void(0);" group="'+o+'">'+q.name+"</a></li>")});if(i>1){l.push('</ul><br style="clear:both;" />');p=d(l.join(""));d("a",p).click(function(){Ba=d(this).attr("group");
b.exec("Emot");return false});c.append(p)}b.showPanel(c)};this.showTable=function(){var a=d('<div>\u884c\u6570\u5217\u6570: <input type="text" id="xheTableRows" style="width:40px;" value="3" /> x <input type="text" id="xheTableColumns" style="width:40px;" value="2" /></div><div>\u6807\u9898\u5355\u5143: <select id="xheTableHeaders"><option selected="selected" value="">\u65e0</option><option value="row">\u7b2c\u4e00\u884c</option><option value="col">\u7b2c\u4e00\u5217</option><option value="both">\u7b2c\u4e00\u884c\u548c\u7b2c\u4e00\u5217</option></select></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheTableWidth" style="width:40px;" value="200" /> x <input type="text" id="xheTableHeight" style="width:40px;" value="" /></div><div>\u8fb9\u6846\u5927\u5c0f: <input type="text" id="xheTableBorder" style="width:40px;" value="1" /></div><div>\u8868\u683c\u95f4\u8ddd: <input type="text" id="xheTableCellSpacing" style="width:40px;" value="1" /> \u8868\u683c\u586b\u5145: <input type="text" id="xheTableCellPadding" style="width:40px;" value="1" /></div><div>\u5bf9\u9f50\u65b9\u5f0f: <select id="xheTableAlign"><option selected="selected" value="">\u9ed8\u8ba4</option><option value="left">\u5de6\u5bf9\u9f50</option><option value="center">\u5c45\u4e2d</option><option value="right">\u53f3\u5bf9\u9f50</option></select></div><div>\u8868\u683c\u6807\u9898: <input type="text" id="xheTableCaption" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>'),
c=d("#xheTableRows",a),e=d("#xheTableColumns",a),h=d("#xheTableHeaders",a),m=d("#xheTableWidth",a),k=d("#xheTableHeight",a),p=d("#xheTableBorder",a),n=d("#xheTableCellSpacing",a),j=d("#xheTableCellPadding",a),f=d("#xheTableAlign",a),g=d("#xheTableCaption",a);d("#xheSave",a).click(function(){b.loadBookmark();var i=g.val(),l=p.val(),o=c.val(),q=e.val(),t=h.val(),x=m.val(),M=k.val(),w=n.val(),v=j.val(),E=f.val();l="<table"+(l!=""?' border="'+l+'"':"")+(x!=""?' width="'+x+'"':"")+(M!=""?' width="'+M+
'"':"")+(w!=""?' cellspacing="'+w+'"':"")+(v!=""?' cellpadding="'+v+'"':"")+(E!=""?' align="'+E+'"':"")+">";if(i!="")l+="<caption>"+i+"</caption>";if(t=="row"||t=="both"){l+="<tr>";for(i=0;i<q;i++)l+='<th scope="col">&nbsp;</th>';l+="</tr>";o--}l+="<tbody>";for(i=0;i<o;i++){l+="<tr>";for(x=0;x<q;x++)l+=x==0&&(t=="col"||t=="both")?'<th scope="row">&nbsp;</th>':"<td>&nbsp;</td>";l+="</tr>"}l+="</tbody></table>";b.pasteHTML(l);b.hidePanel();return false});b.showDialog(a)};this.showAbout=function(){var a=
d('<div style="width:200px;word-wrap:break-word;word-break:break-all;"><p><span style="font-size:20px;color:#1997DF;">xhEditor</span><br />v1.0.0 rc2 build 100401</p><p>xhEditor\u662f\u4e00\u4e2a\u57fa\u4e8ejQuery\u5f00\u53d1\u7684\u8de8\u5e73\u53f0\u5f00\u6e90\u8ff7\u4f60XHTML\u7f16\u8f91\u5668\u7ec4\u4ef6\u3002</p><p><a href="http://xheditor.com/" target="_blank">http://xheditor.com/</a></p></div>');b.showDialog(a)};this.attr=function(a,c,e){if(!c)return false;var h="_xhe_"+c;e&&a.attr(c,e).removeAttr(h).attr(h,
e);return a.attr(h)||a.attr(c)};this.addShortcuts=function(a,c){a=a.toLowerCase();if(qa[a]==undefined)qa[a]=Array();qa[a].push(c)};this.checkShortcuts=function(a){if(A||J)return true;var c=a.which,e=Oa[c];c=e?e:String.fromCharCode(c).toLowerCase();sKey="";sKey+=a.ctrlKey?"ctrl+":"";sKey+=a.altKey?"alt+":"";sKey+=a.shiftKey?"shift+":"";sKey+=c;if(a=qa[sKey]){d.each(a,function(h,m){d.isFunction(m)?m.call(b):b.exec(m)});return false}};this.uploadInit=function(a,c,e,h){function m(j){var f=false,g=b.settings.onUpload,
i=G(j,"string")?j:j.url;if(i.substr(0,1)=="!"){f=true;i=i.substr(1)}h?h(i):a.val(i);g&&g(j);f&&a.closest(".xheDialog").find("#xheSave").click()}var k=d('<span class="xheUpload"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="'+b.settings.upBtnText+'" class="xheBtn" tabindex="-1" /></span>'),p=d(".xheBtn",k);a.after(k);p.before(a);c=c.replace("{editorRoot}",S);if(c.substr(0,1)=="!")p.click(function(){R=false;b.showIframeModal("\u4e0a\u4f20\u6587\u4ef6",c.substr(1),
m,null,null,function(){R=true})});else{k.append('<input type="file" class="xheFile" size="13" name="filedata" tabindex="-1" />');var n=d(".xheFile",k);n.change(function(){var j=n.val();if(j!="")if(j.match(new RegExp(".("+e.replace(/,/g,"|")+")$","i"))){R=false;var f;f=new b.ajaxUpload(n,c,function(g){b.removeModal();g.err?alert(g.err):m(g.msg)},function(){b.removeModal()});b.showModal("\u6587\u4ef6\u4e0a\u4f20\u4e2d(Esc\u53d6\u6d88\u4e0a\u4f20)",'<div style="margin:22px 0;text-align:center;line-height:30px;">\u6587\u4ef6\u4e0a\u4f20\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026<br /><img src="'+
Aa+'img/loading.gif"></div>',320,150,function(){R=true;f.remove()});f.start()}else alert("\u4e0a\u4f20\u6587\u4ef6\u6269\u5c55\u540d\u5fc5\u9700\u4e3a: "+e)})}};this.ajaxUpload=function(a,c,e,h){var m="jUploadFrame"+(new Date).getTime(),k=this,p=d('<iframe name="'+m+'" class="xheHideArea" />').appendTo("body"),n=d('<form action="'+c+'" target="'+m+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body"),j=d(a),f=j.clone().attr("disabled","true");j.before(f).appendTo(n);
this.remove=function(){if(k!=null){f.before(j).remove();p.remove();n.remove();k=null}};this.onLoad=function(){var g=d(p[0].contentWindow.document.body).text(),i=Object;k.remove();try{i=eval("("+g+")")}catch(l){}if(i.err!=undefined&&i.msg!=undefined)e(i);else{alert(c+" \u4e0a\u4f20\u63a5\u53e3\u53d1\u751f\u9519\u8bef\uff01\r\n\r\n\u8fd4\u56de\u7684\u9519\u8bef\u5185\u5bb9\u4e3a: \r\n\r\n"+g);h()}};this.start=function(){n.submit();p.load(k.onLoad)};return this};this.showIframeModal=function(a,c,e,h,
m,k){c=d('<iframe frameborder="0" src="'+c.replace("{editorRoot}",S)+'" style="width:100%;height:100%;display:none;" /><div class="xheModalIfmWait"></div>');var p=d(c[0]),n=d(c[1]);b.showModal(a,c,h,m,k);p.load(function(){var j=p[0].contentWindow,f=d(j.document);j.callback=function(g){b.removeModal();e(g)};f.keydown(b.modalEscCheck);p.show();n.remove()})};this.showModal=function(a,c,e,h,m){if(d(".xheModal").length==1)return false;var k,p,n,j,f;e=e?e:b.settings.modalWidth;h=h?h:b.settings.modalHeight;
j=b.settings.layerShadow;k=d('<div class="xheModal" style="width:'+(e-1)+"px;height:"+h+"px;margin-left:-"+Math.ceil(e/2)+"px;"+(y&&ta<=7?"":"margin-top:-"+Math.ceil(h/2)+"px")+'">'+(b.settings.modalTitle?'<div class="xheModalTitle"><span class="xheModalClose" title="\u5173\u95ed (Esc)"></span>'+a+"</div>":"")+'<div class="xheModalContent"></div></div>').appendTo("body");n=d('<div class="xheModalOverlay"></div>').appendTo("body");if(j>0)p=d('<div class="xheModalShadow" style="width:'+k.outerWidth()+
"px;height:"+k.outerHeight()+"px;margin-left:-"+(Math.ceil(e/2)-j-2)+"px;"+(y&&ta<=7?"":"margin-top:-"+(Math.ceil(h/2)-j-2)+"px")+'"></div>').appendTo("body");d(".xheModalContent",k).css("height",h-(b.settings.modalTitle?d(".xheModalTitle").outerHeight():0)).html(c);if(y&&ta==6)f=d("select:visible").css("visibility","hidden");this.removeModal=function(){f&&f.css("visibility","visible");d(document).unbind("keydown",b.modalEscCheck);k.remove();j>0&&p.remove();n.remove();m&&m()};this.modalEscCheck=function(g){if(g.which==
27){b.removeModal();return false}};d(document).keydown(b.modalEscCheck);d(".xheModalClose",k).click(b.removeModal);n.show();j>0&&p.show();k.show()};this.showDialog=function(a){var c=d('<div class="xheDialog"></div>');a=d(a);var e=d("#xheSave",a);if(e.length==1){a.find("input,select").keypress(function(k){if(k.which==13){e.click();return false}});e.after(' <input type="button" id="xheCancel" value="\u53d6\u6d88" />');d("#xheCancel",a).click(b.hidePanel);if(!b.settings.clickCancelDialog){la=false;var h=
d('<div class="xheFixCancel"></div>').appendTo("body").mousedown(function(){return false}),m=O.offset();h.css({left:m.left,top:m.top,width:O.outerWidth(),height:O.outerHeight()})}c.mousedown(function(){ga=true})}c.append(a);b.showPanel(c)};this.clickCancelPanel=function(){la&&b.hidePanel()};this.showPanel=function(a){if(!L.target)return false;K.empty().append(a).css("left",0).css("top",0);ba=d(L.target).closest("a").addClass("xheActive");var c=ba.offset();a=c.left;c=c.top;c+=ba.outerHeight()-1;aa.css({left:a+
1,top:c}).show();if(a+K.outerWidth()>document.body.clientWidth)a-=K.outerWidth()-ba.outerWidth();var e=b.settings.layerShadow;e>0&&$.css({left:a+e,top:c+e,width:K.outerWidth(),height:K.outerHeight()}).show();K.css("left",a).css("top",c).show();ya=R=true};this.hidePanel=function(){if(R){ba.removeClass("xheActive");$.hide();aa.hide();K.hide();R=false;if(!la){d(".xheFixCancel").remove();la=true}ya=ga=false;U=null}};this.exec=function(a){b.hidePanel();b.focus();b.saveBookmark();var c=ca[a];if(!c)return false;
if(L==null){L={};var e=C.find(".xheButton[name="+a+"]");if(e.length==1)L.target=e}if(c.e){c.e.call(b);return L=null}a=a.toLowerCase();switch(a){case "cut":try{s.execCommand(a);if(!s.queryCommandSupported(a))throw"Error";}catch(h){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + X)\u6765\u5b8c\u6210")}break;case "copy":try{s.execCommand(a);if(!s.queryCommandSupported(a))throw"Error";
}catch(m){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + C)\u6765\u5b8c\u6210")}break;case "paste":try{s.execCommand(a);if(!s.queryCommandSupported(a))throw"Error";}catch(k){alert("\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u4f7f\u7528\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl + V)\u6765\u5b8c\u6210")}break;
case "pastetext":window.clipboardData?b.pasteText(window.clipboardData.getData("Text",true)):b.showPastetext();break;case "blocktag":var p=[];d.each(Qa,function(f,g){p.push({s:"<"+g.n+">"+g.t+"</"+g.n+">",v:"<"+g.n+">",t:g.t})});b.showMenu(p,function(f){b._exec("formatblock",f)});break;case "fontface":var n=[];d.each(Ra,function(f,g){g.c=g.c?g.c:g.n;n.push({s:'<span style="font-family:'+g.c+'">'+g.n+"</span>",v:g.c,t:g.n})});b.showMenu(n,function(f){b._exec("fontname",f)});break;case "fontsize":var j=
[];d.each(P,function(f,g){j.push({s:'<span style="font-size:'+g.s+';">'+g.t+"("+g.s+")</span>",v:f+1,t:g.t})});b.showMenu(j,function(f){b._exec("fontsize",f)});break;case "fontcolor":b.showColor(function(f){b._exec("forecolor",f)});break;case "backcolor":b.showColor(function(f){if(y)b._exec("backcolor",f);else{b.setCSS(true);b._exec("hilitecolor",f);b.setCSS(false)}});break;case "align":b.showMenu(Sa,function(f){b._exec(f)});break;case "list":b.showMenu(Ta,function(f){b._exec(f)});break;case "link":b.showLink();
break;case "img":b.showImg();break;case "flash":b.showEmbed("Flash",'<div>\u52a8\u753b\u6587\u4ef6: <input type="text" id="xheFlashSrc" value="http://" class="xheText" /></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheFlashWidth" style="width:40px;" value="480" /> x <input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>',"application/x-shockwave-flash","clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000",
' wmode="opaque" quality="high" menu="false" play="true" loop="true"',b.settings.upFlashUrl,b.settings.upFlashExt);break;case "media":b.showEmbed("Media",'<div>\u5a92\u4f53\u6587\u4ef6: <input type="text" id="xheMediaSrc" value="http://" class="xheText" /></div><div>\u5bbd\u5ea6\u9ad8\u5ea6: <input type="text" id="xheMediaWidth" style="width:40px;" value="480" /> x <input type="text" id="xheMediaHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><input type="button" id="xheSave" value="\u786e\u5b9a" /></div>',
"application/x-mplayer2","clsid:6bf52a52-394a-11d3-b153-00c04f79faa6",' enablecontextmenu="false" autostart="false"',b.settings.upMediaUrl,b.settings.upMediaExt);break;case "emot":b.showEmot();break;case "table":b.showTable();break;case "source":b.toggleSource();break;case "preview":b.togglePreview();break;case "fullscreen":b.toggleFullscreen();break;case "about":b.showAbout();break;default:b._exec(a);break}L=null};this._exec=function(a,c){a=c!=undefined?s.execCommand(a,false,c):s.execCommand(a,false,
null);b.triggerChange();return a}};d(function(){d.fn.oldVal=d.fn.val;d.fn.val=function(B){var D;return this[0]&&(D=this[0].editor)?B===undefined?D.getSource():D.setSource(B):this.oldVal(B)};d("textarea.xheditor").xheditor();d("textarea.xheditor-mini").xheditor({tools:"mini"});d("textarea.xheditor-simple").xheditor({tools:"simple"})})})(jQuery);
